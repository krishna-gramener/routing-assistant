<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Insights Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary border-bottom">
        <div class="container-fluid">
            <div class="d-flex align-items-center">
                <i class="bi bi-graph-up-arrow me-2 fs-4"></i>
                <span class="navbar-brand mb-0 h5 fw-bold">Data Insights Platform</span>
            </div>
            <button class="btn btn-outline-light btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#settingsCollapse">
                <i class="bi bi-gear me-1"></i>Settings
            </button>
        </div>
    </nav>

    <!-- Collapsible Settings Panel -->
    <div class="collapse" id="settingsCollapse">
        <div class="bg-white border-bottom shadow-sm">
            <div class="container-fluid py-3">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <small class="text-muted fw-semibold">Data Sources:</small>
                        <span class="badge bg-secondary ms-2" id="files-status">Loading...</span>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <button class="btn btn-primary btn-sm" id="config-llm-btn">
                            <i class="bi bi-play-circle me-1"></i>Initialize Analysis Engine
                        </button>
                        <div class="mt-1">
                            <small class="text-muted" id="config-status">Click to activate</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid py-4">
        <div class="row">
            <!-- Left Sidebar -->
            <div class="col-lg-3 mb-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-bottom py-2">
                        <h6 class="mb-0 fw-semibold text-dark">
                            <i class="bi bi-lightbulb me-2"></i>Sample Questions
                        </h6>
                    </div>
                    <div class="card-body py-2">
                        <div class="d-grid gap-1" id="sample-questions">
                            <button class="btn btn-outline-secondary text-start sample-question-btn text-decoration-none py-2" data-question="Rank the top 5 and bottom 5 districts by MMR">
                                <i class="bi bi-list-ol me-2"></i>Rank districts by MMR
                            </button>
                            <button class="btn btn-outline-secondary text-start sample-question-btn text-decoration-none py-2" data-question="Compare anemia prevalence in Lucknow, Gorakhpur, and Jhansi">
                                <i class="bi bi-bar-chart me-2"></i>Compare anemia prevalence
                            </button>
                            <button class="btn btn-outline-secondary text-start sample-question-btn text-decoration-none py-2" data-question="Rank the top and bottom districts by Iron-Folic Acid consumption">
                                <i class="bi bi-capsule me-2"></i>Iron-Folic Acid consumption
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm mt-3">
                    <div class="card-header bg-white border-bottom">
                        <h6 class="mb-0 fw-semibold text-dark">
                            <i class="bi bi-sliders me-2"></i>Response Settings
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label small fw-semibold text-muted">Format</label>
                            <select class="form-select form-select-sm" id="format-select">
                                <option value="Summary">Summary</option>
                                <option value="e-mail">E-mail</option>
                                <option value="Bullet Points">Bullet Points</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label small fw-semibold text-muted">Language</label>
                            <select class="form-select form-select-sm" id="language-select">
                                <option value="English">English</option>
                                <option value="Hindi">Hindi</option>
                                <option value="Marathi">Marathi</option>
                                <option value="Telugu">Telugu</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="col-lg-9">
                <!-- Search Interface -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body p-4">
                        <div class="input-group input-group-lg">
                            <input type="text" class="form-control" id="user-question" 
                                   placeholder="Ask your question about healthcare data..." disabled>
                            <button class="btn btn-outline-secondary" id="mic-btn" title="Click to speak">
                                <i class="bi bi-mic" id="mic-icon"></i>
                            </button>
                            <button class="btn btn-primary px-4" id="send-btn" disabled>
                                <span id="send-text">Ask</span>
                                <span id="loading-spinner" class="spinner-border spinner-border-sm d-none ms-2"></span>
                            </button>
                            <button class="btn btn-outline-secondary" id="reset-btn" title="Reset Chat">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Chat Area -->
                <div class="card border-0 shadow-sm" style="min-height: 800px;" id="chat-messages">
                    <div class="card-header bg-white border-bottom d-none" id="chat-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0 fw-semibold text-dark">
                                <i class="bi bi-chat-text me-2"></i>Analysis Results
                            </h6>
                            <div class="btn-group btn-group-sm" role="group">
                                <button class="btn btn-outline-secondary" id="speak-btn" title="Read aloud">
                                    <i class="bi bi-volume-up" id="speak-icon"></i>
                                </button>
                                <button class="btn btn-outline-secondary d-none" id="pause-btn" title="Pause reading">
                                    <i class="bi bi-pause"></i>
                                </button>
                                <button class="btn btn-outline-secondary d-none" id="stop-btn" title="Stop reading">
                                    <i class="bi bi-stop"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body d-flex align-items-center justify-content-center" id="chat-body" style="overflow-y: auto; max-height: 750px;">
                        <div class="text-center text-muted">
                            <i class="bi bi-chat-dots display-1 mb-3 opacity-25"></i>
                            <h5 class="fw-light">Welcome to NITI Data Insights</h5>
                            <p class="mb-0 text-muted">Ask questions about healthcare data to get AI-powered insights</p>
                        </div>
                    </div>
                </div>

                <!-- Follow-up Questions Section -->
                <div class="card border-0 shadow-sm mt-3 d-none" id="followup-questions-card">
                    <div class="card-header bg-gradient" style="background: linear-gradient(45deg, #f8f9fa, #e9ecef);">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-lightbulb-fill text-warning me-2"></i>
                            <h6 class="mb-0 fw-semibold text-dark">Suggested Follow-up Questions</h6>
                            <small class="text-muted ms-auto">AI-generated based on your analysis</small>
                        </div>
                    </div>
                    <div class="card-body py-3">
                        <div id="followup-questions-container" class="d-grid gap-2">
                            <!-- Follow-up questions will be dynamically inserted here -->
                        </div>
                        <div id="followup-loading" class="text-center text-muted d-none">
                            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                            <small>Generating personalized follow-up questions...</small>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="script.js"></script>
    <script type="module">
        import { html, render } from 'https://cdn.jsdelivr.net/npm/lit-html@3/lit-html.js';
        
        // Modern event handling for sample questions
        document.addEventListener('DOMContentLoaded', function() {
            const sampleQuestionsContainer = document.getElementById('sample-questions');
            
            if (sampleQuestionsContainer) {
                sampleQuestionsContainer.addEventListener('click', function(event) {
                    if (event.target.classList.contains('sample-question-btn')) {
                        const question = event.target.dataset.question;
                        const userQuestionInput = document.getElementById('user-question');
                        const sendButton = document.getElementById('send-btn');
                        
                        // Fill the input field
                        userQuestionInput.value = question;
                        
                        // Enable the input and send button if they're disabled
                        if (userQuestionInput.disabled) {
                            userQuestionInput.disabled = false;
                        }
                        if (sendButton.disabled) {
                            sendButton.disabled = false;
                        }
                        
                        // Trigger the send button click to auto-submit
                        sendButton.click();
                    }
                });
            }
        });
    </script>
</body>
</html>